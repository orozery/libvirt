From d61f95cf6a6fbd564e104c168d325581acd9cd8d Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?J=C3=A1n=20Tomko?= <jtomko@redhat.com>
Date: Mon, 20 Jan 2020 07:55:48 +0100
Subject: [PATCH] qemu: end the agent job in qemuDomainSetTimeAgent
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This function grabs an agent job but ends a monitor job.
End the agent job instead.

https://bugzilla.redhat.com/show_bug.cgi?id=1792723

Signed-off-by: JÃ¡n Tomko <jtomko@redhat.com>
Reported-by: Dan Zheng <dzheng@redhat.com>
Fixes: e005c95f56fee9ed780be7f8db103d690bd34cbd

Origin: upstream, https://libvirt.org/git/?p=libvirt.git;a=commit;h=d61f95cf6a6
Bug-Ubuntu: https://bugs.launchpad.net/bugs/1865425
Last-Update: 2020-03-02

---
 src/qemu/qemu_driver.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/qemu/qemu_driver.c b/src/qemu/qemu_driver.c
index 7e379fe83a..2f66d7cd9a 100644
--- a/src/qemu/qemu_driver.c
+++ b/src/qemu/qemu_driver.c
@@ -20464,7 +20464,7 @@ qemuDomainSetTimeAgent(virQEMUDriverPtr driver,
     qemuDomainObjExitAgent(vm, agent);
 
  endjob:
-    qemuDomainObjEndJob(driver, vm);
+    qemuDomainObjEndAgentJob(vm);
     return ret;
 }
 
-- 
2.25.1

